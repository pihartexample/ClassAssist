---
---
const loadLimit=20;let limitsLoaded=0,max_index=parseInt(localStorage.getItem("index")),title=document.getElementById("title");title.appendChild(generateSelect(filters,(function(){filterMessages(!0)})));const filterEl=document.getElementById("filter"),loadMore=document.getElementById("load"),outputBox=document.getElementById("messages");function generateSelect(e,t){const n=document.createElement("select");return n.id="filter",e.forEach((e,t)=>{const s=document.createElement("option");s.textContent=t,n.appendChild(s)}),n.addEventListener("change",t),n}function filterMessages(e){const t=filterEl.value;if(e&&(limitsLoaded=0,outputBox.innerHTML='<div class="lds-ring"><div></div><div></div><div></div><div></div></div><div class="card"><h7>Loading</h7><h1>If you can see this, your JavaScript is enabled, but we can\'t load your content. Check your Internet connection and see if you can access <a href="https://sheets.google.com">Google Sheets</a>.</h1><date></date></div>'),"All"===t)getMessages();else{getMessages('where+C="'+(filters.get(t)||t)+'"+')}}function loadMessages(e,t,n){loadMore.style.display="unset",e=CSVToArray(e,null),1===limitsLoaded&&(outputBox.innerHTML="");for(let s=t?1:0;s<e.length-(n?1:0);s++){const t=e[s],n=parseInt(t[0]),d=t[1],a=t[2],o=t[3],i=t[4],l=document.createElement("div");l.classList.add("card");const c=document.createElement("h7"),r=document.createElement("img");r.src="assets/icons/"+icons.get(a),r.classList.add("icon"),c.appendChild(r);const m=document.createElement("span");m.innerHTML="&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"+o,c.appendChild(m),l.appendChild(c);const p=document.createElement("h1");p.attachMarkdown(i),l.appendChild(p);const u=document.createElement("date");u.textContent=d,l.appendChild(u),l.addEventListener("click",(function(){show(this)})),n>localStorage.getItem("index")&&(l.classList.add("new"),max_index=Math.max(n,max_index)),outputBox.appendChild(l)}document.querySelectorAll("#messages .card").length<20*limitsLoaded&&(loadMore.style.display="none"),localStorage.setItem("index",max_index)}function getMessages(e){const t=makeHttpObject(),n="select * "+(e||"")+"limit 20 offset "+20*limitsLoaded++;t.open("GET","https://docs.google.com/spreadsheets/d/{{ site.public_messages_spreadsheet_id }}/gviz/tq?tqx=out:csv&tq="+n,!0),t.send(null),t.onreadystatechange=function(){4===t.readyState&&loadMessages(t.responseText,!0,!1)}}getMessages();